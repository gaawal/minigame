<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D 轨迹弹球游戏（国内CDN版）</title>

  <!-- TailwindCSS (BootCDN) -->
  <script src="https://cdn.bootcdn.net/ajax/libs/tailwindcss/3.4.1/tailwind.min.js"></script>

  <!-- Vue 3 (BootCDN) -->
  <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.4.21/vue.global.prod.min.js"></script>

  <!-- Three.js (BootCDN) -->
  <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r152/three.min.js"></script>
  <!-- OrbitControls -->
  <script src="https://cdn.bootcdn.net/ajax/libs/three.js/r152/examples/js/controls/OrbitControls.min.js"></script>

  <style>
    html,body,#app { height: 100%; margin: 0; }
    canvas { display: block; }
  </style>
</head>
<body>
  <div id="app" class="h-full flex">
    <!-- 左侧画布 -->
    <div id="game" class="flex-1 relative">
      <div ref="overlay" class="absolute top-4 left-4 text-white z-10">
        <div class="bg-black/40 rounded p-2 text-sm">
          <div>得分: <span class="font-bold text-yellow-300">{{ score }}</span></div>
          <div>球剩余: <span class="font-bold">{{ ballsLeft }}</span></div>
        </div>
      </div>
    </div>

    <!-- 右侧面板 -->
    <div class="w-80 bg-gray-900 text-white p-4">
      <h2 class="text-xl font-bold mb-4">3D 轨迹弹球</h2>
      <div class="mb-2">当前得分: <span class="text-yellow-300">{{ score }}</span></div>
      <button @click="spawnBall()" class="px-3 py-2 bg-green-600 hover:bg-green-500 rounded text-white text-sm">发射球</button>
      <button @click="resetGame()" class="px-3 py-2 bg-red-600 hover:bg-red-500 rounded text-white text-sm ml-2">重置</button>
    </div>
  </div>

  <script>
  const { createApp } = Vue;
  createApp({
    data() {
      return {
        score: 0,
        ballsLeft: 3,
        scene: null, renderer: null, camera: null,
        balls: [],
        lastTime: performance.now()
      };
    },
    methods: {
      initThree(container) {
        const width = container.clientWidth, height = container.clientHeight;
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(width, height);
        container.appendChild(this.renderer.domElement);

        this.scene = new THREE.Scene();
        this.scene.background = new THREE.Color(0x0b0f1a);

        this.camera = new THREE.PerspectiveCamera(50, width/height, 0.1, 200);
        this.camera.position.set(0, 25, 28);
        this.camera.lookAt(0,0,0);

        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(10,20,10);
        this.scene.add(light);

        const floor = new THREE.Mesh(
          new THREE.BoxGeometry(20,1,40),
          new THREE.MeshStandardMaterial({ color:0x1a3a2a })
        );
        floor.position.y=-0.5;
        this.scene.add(floor);

        this.spawnBall();

        const animate = () => {
          this.renderer.render(this.scene, this.camera);
          requestAnimationFrame(animate);
        };
        animate();
      },
      spawnBall() {
        if(this.ballsLeft<=0) return;
        const ball = new THREE.Mesh(
          new THREE.SphereGeometry(1,16,12),
          new THREE.MeshStandardMaterial({color:0x66b2ff})
        );
        ball.position.set(0,5,0);
        this.scene.add(ball);
        this.balls.push(ball);
        this.ballsLeft--;
      },
      resetGame() {
        this.balls.forEach(b=>this.scene.remove(b));
        this.balls = [];
        this.score=0;
        this.ballsLeft=3;
      }
    },
    mounted() {
      const container=document.getElementById('game');
      this.initThree(container);
    }
  }).mount('#app');
  </script>
</body>
</html>